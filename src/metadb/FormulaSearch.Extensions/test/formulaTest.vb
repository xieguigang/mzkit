Imports BioNovoGene.Analytical.MassSpectrometry.Math
Imports BioNovoGene.BioDeep.Chemoinformatics.Formula
Imports Microsoft.VisualBasic.ComponentModel.Ranges.Model
Imports Microsoft.VisualBasic.Linq
Imports Microsoft.VisualBasic.Math.Distributions
Imports Microsoft.VisualBasic.Math.Distributions.BinBox
Imports Microsoft.VisualBasic.Serialization.JSON

Module formulaTest

    Sub Main()
        Dim formulas = New String() {"[C21H21O12]+", "[C27H31O16]+", "C27H31O15
C27H31O15+
C38H41O20+
C16H12O6
C16H13O6
[C16H13O6]+
C16H13O6+
C24H25O12
C31H29O14
C43H49O24
C25H25O14+
C31H35O19
C31H29O13
C38H41O17
C28H32O16
C28H33O16
C27H30O15
C37H38O19
C37H39O19
C43H48O24
C49H59O29
C33H40O19
C33H41O19
C43H49O23
C44H51O24
C22H22O11
C22H23O11
C22H23O11+
C34H42O21
C34H43O21
C30H35O17
C43H49O22
C43H49O22+
C21H21O10
C21H21O10+
C57H68O31
C28H33O16+
C43H48O23
C22H22O10
C22H23O10+
C22H23O10
C28H32O15
C28H33O15+
C28H33O15
C34H42O20
C34H43O20
C33H41O20
C34H43O21+
[C34H43O21]+
C30H34O17
C30H35O17+
C43H48O22
[C22H23O11]+
C41H44O25
C25H25O14
C53H57O27
C50H53O26", "C15H14O3
C58H59O37
C57H59O35
C30H27O13+
C30H27O13
C15H14O6
C31H29O13+
C31H29O13
C27H23O16
C24H20O13
C24H21O13
C24H21O13+
C24H20O12
C24H21O12
C24H21O12+
C15H14O5
C22H22O11
C22H23O11
C15H10O7
C15H11O7+
C15H11O7
C24H22O15
C24H23O15
C24H23O15+
C21H20O12
C21H21O12
C21H21O12+
C27H30O16
C27H31O16
C21H20O11
C21H21O11
C27H30O15
C27H31O15
C15H10O6
[C15H11O6]+
C15H11O6+
C15H11O6
C35H28O19
C35H29O19
C29H33O16
C28H25O15
C34H34O19
C34H35O19
C33H40O20
C33H41O20+
C33H41O20
[C33H41O20]+
C36H36O19
C36H37O19
C27H29O17
C32H38O19
C32H39O19+
C32H39O19
C27H25O17
C38H47O22+
C24H23O14+
C23H22O12
C23H23O12+
C23H23O12
C36H37O18
C42H47O23
C30H31O20
C35H35O18
C41H45O22
C51H53O27
C54H55O28
C55H61O29+
C55H61O29
C29H33O17
C55H57O30
C52H55O27
C30H27O14
C39H39O22
C42H47O24
C25H21O17
C56H59O30
C53H57O27
C54H59O28
C40H41O22
C40H41O22+
C37H39O19
C30H33O19
C45H49O27
C46H51O27
C62H71O38
C30H32O19
C29H31O18
C36H43O24+
C36H43O24
C25H25O15
C36H36O18
C55H57O29
C42H41O24
C35H35O17
C35H35O17+
C44H51O25
C30H27O14+
C42H47O24+
C30H25O13-
C30H26O13
C43H49O24
C43H49O24+
C33H41O21+
C27H31O16+
C33H41O21
C31H34O18
C31H35O18
C31H35O18+
C33H34O22
C33H35O22
C31H33O19
C51H52O26
C51H53O26
C51H52O25
C51H53O25
C42H46O24
C48H57O29
C49H59O29
C48H57O28
C42H46O23
C41H44O22
C39H42O22
C39H43O22
C43H48O24
C26H28O15
C26H29O15
C51H53O27+
C33H40O21
C36H37O19+
C29H32O17
C41H45O23
C41H45O23+
C42H47O23+
C27H29O17+
C32H39O20
C42H44O24
C22H21O11+
C32H39O20+
C30H33O19+
C23H21O13+
C41H45O22+
C25H25O14
C35H40O23
C35H41O23
C52H55O26
C58H65O31
C61H67O34
C72H78O40
C72H79O40
C72H79O40+
C57H62O32
C57H63O32
C66H68O35
C66H69O35
C66H68O33
C66H69O33
C50H57O30
C44H47O25
C47H55O27
C58H63O32
C75H81O43
C75H81O40
C20H19O10
C20H19O10+
C36H37O18+
C26H29O15+
C33H35O22+
[C21H21O11]+
C21H21O11+
C21H20O10
C21H21O10+
C21H21O10
[C27H31O15]+
C32H38O20
[C32H39O20]+
[C27H31O16]+
C27H31O15+
C42H46O22
C42H47O22
C39H51O25
[C33H41O21]+
C38H47O22
C42H47O22+
[C42H57O17]+
C38H41O20
C42H47O21
C43H49O23
C45H49O25
C24H23O14",
"C73H79O42
C72H77O41
C24H22O16
C24H23O16
C21H20O13
C21H21O13
C21H21O13+
C27H30O17
C27H31O17
C27H31O17+
C27H30O16
C27H31O16
C28H25O16
C32H38O20
C32H39O20
C30H32O19
C30H33O19
C34H40O22
C34H41O22
C32H38O21
C32H39O21
C30H27O14+
C23H23O13
C39H38O22
C39H39O22+
C39H39O22
C54H55O29
C23H23O13+
C24H23O15
C30H32O20
C30H33O20
C33H35O23+
C33H35O23
C58H63O33
C29H31O19
C35H39O25
C31H35O21
C23H22O13
C45H48O26
C45H49O26
C30H27O14
C53H56O28
C53H57O28
C33H41O22
C42H47O25
C42H47O24
C31H34O19
C31H35O19
C31H35O19+
[C27H31O17]+
C31H33O20
C75H75O35
C57H63O31
C56H58O31
C56H59O31
C55H56O30
C55H57O30
C29H32O17
C29H33O17
C29H33O17+
C42H46O24
C42H47O23
C42H46O23
C39H38O23
C39H39O23
C30H27O15
C30H26O15
C30H27O15+
C31H29O15
C31H29O15+
C21H20O12
[C21H21O12]+
C21H21O12
C21H21O12+
C36H36O20
C36H37O20
C36H37O20+
C36H36O19
C36H37O19+
C29H32O18
C29H33O18
C29H33O18+
C51H53O27
C51H52O28
C51H53O28+
C51H53O28
C66H69O33
C55H61O30
C26H28O16
C26H29O16
C26H29O16+
C36H42O24
C36H43O24
C30H27O17
C58H58O36
C58H59O36
C60H63O37
C57H61O34
C57H62O31
C48H56O28
C48H57O28
C41H40O23
C41H41O23
C27H25O18
C20H19O11
C30H26O14
C36H37O19
C21H21O11
[C27H31O16]+
C27H31O16+
C57H63O30
[C26H29O16]+
C43H48O24
C43H49O24
C42H47O23+
C33H40O21
C33H41O21
C33H41O21+
[C33H41O21]+
C32H39O21+
C33H41O22+
C33H40O22
C20H19O11+
[C20H19O11]+
C15H10O7
[C15H11O7]+
C15H11O7",
"C26H29O14+
C31H33O18
C15H10O5
[C15H11O5]+
C15H11O5
C15H11O5+
C53H57O26
C42H47O23
C29H33O15
C33H40O19
C33H41O19
C33H41O19+
C32H38O18
C32H39O18
C43H49O22
C36H37O16
C43H46O25
C43H47O25
C55H57O28
C23H23O11
C29H33O16
C30H27O13
C56H59O29
C37H39O18
C45H49O25
C24H23O13+
C24H23O13
C32H35O19
C30H33O18
C39H39O21
C30H32O18
C30H26O12
C30H27O12
C30H27O12+
C52H55O25
C39H39O20
C38H39O18
C44H47O24
C25H25O13+
C31H35O18
C31H34O17
C31H35O17
C31H35O17+
[C27H31O15]+
C27H30O15
C27H31O15
C36H37O18
C36H36O17
C36H37O17
C36H36O18
C42H46O23
C48H57O28
C33H40O20
C33H41O20
C40H44O22
C40H45O22
C40H45O22+
C26H28O14
C26H29O14
C27H30O14
C27H31O14
C30H27O13+
C54H54O29
C54H55O29
C53H56O26
C51H52O26
C51H53O26
C52H54O26
C52H55O26
C51H52O25
C51H53O25
C52H54O25
C43H48O23
C43H49O23
C78H88O44
C78H89O44
C57H62O31
C57H63O31
C29H30O17
C29H31O17
C30H32O17
C30H33O17
C30H33O17+
C42H46O22
C42H47O22
C43H49O23+
C46H51O26
C45H49O25+
C27H25O16
C20H18O9
C20H19O9
[C20H19O9]+
C20H19O9+
[C21H21O10]+
C36H37O17+
C21H21O10+
C54H62O28
C28H33O14
C28H33O14+
C27H31O15+
C21H20O9
C21H21O9+
C21H21O9
C27H31O14+
C46H54O26
C46H55O26
C40H44O21
C40H45O21
C40H45O21+
C32H38O19
C32H39O19
C32H39O19+
C33H41O20+
C21H20O10
C21H21O10",
"C16H12O7
C16H13O7+
[C16H13O7]+
C37H39O18
C24H25O13
C24H25O13+
C25H25O15
C31H29O14
C40H41O22
C37H39O19
C28H32O17
C28H33O17+
C28H33O17
C34H36O23
C34H37O23
C33H40O20
C33H41O20
C34H42O22
C34H43O22
C34H43O22+
C30H35O18
C58H64O31
C58H65O31
C44H51O24
C49H59O28
C43H48O24
C43H49O24
C43H48O23
C43H49O23
C43H49O23+
C21H21O11
C22H22O12
C22H23O12+
C22H23O12
[C22H23O12]+
C22H23O10
C28H32O16
C28H33O16
C28H33O16+
C34H43O21
C27H31O16
C34H42O21
[C43H49O23]+
C22H23O11
", "C17H14O7
[C17H15O7]+
C17H15O7
C17H15O7+
C39H41O19
C45H53O24
C45H53O24+
C25H27O13
C31H37O18
C32H31O15
C26H27O15
C32H37O20+
C32H37O20
C38H40O19
C38H41O19+
C38H41O19
C32H31O14
C44H45O25
C29H34O17
[C29H35O17]+
C29H35O17
C29H35O17+
C29H36O17
C35H38O23
C35H39O23
C25H27O10
C25H27O10+
C22H22O11
C22H23O11
C34H33O13
C34H33O13+
C44H50O24
C44H51O24
C35H44O22
C35H45O22
C23H24O12
[C23H25O12]+
C23H25O12+
C31H28O14
C31H29O14+
C31H29O14
C32H30O14
C32H31O14+
C31H28O13
C31H29O13
C31H29O13+
C29H35O20S
C30H34O19
C30H35O19
C32H37O23S
C33H39O19
C26H24O14
C26H25O14
C26H25O14+
C59H66O30
C59H67O30
C60H68O31
C60H69O31
C38H46O24
C38H47O24
C45H52O24
C32H36O19
C32H37O19
C32H37O19+
C41H48O27
C41H49O27
C53H56O26
C53H57O26
C44H50O23
C44H51O23
C59H66O32
C59H67O32
C59H66O31
C59H67O31
C23H25O12
C28H32O16
C28H33O16
C57H68O31
C35H45O21
C38H40O18
C38H41O18
C38H41O18+
C23H24O11
C23H25O11
C23H25O11+
C29H34O16
C29H35O16
C35H44O21
C35H45O21+
C35H45O22+
C44H51O23+
"}

        Dim scores As New List(Of Double)

        For Each str As String In formulas.Select(Function(s) s.LineTokens).IteratesALL
            If str = "" Then
                Continue For
            End If

            Dim score = AnthocyaninValidator.CalculateProbability(str)

            Call Console.WriteLine(str & vbTab & FormulaScanner.EvaluateExactMass(str) & vbTab & score)
            Call scores.Add(score)
        Next

        Dim bins = CutBins.FixedWidthBins(scores, 10).ToArray

        For Each range As SampleDistribution In bins
            Call Console.WriteLine(range.average & vbTab & range.size & vbTab & (range.size / scores.Count * 100).ToString("F2") & "%")
        Next

        Call Console.WriteLine(New DoubleRange(scores).MinMax.GetJson)

        Pause()
    End Sub


End Module
